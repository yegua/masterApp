var queryVue = new Vue({
	el: '#container-wrapper',
	data: {
		title: '站点大师',
		queryCode: '',
		listData: [],
		selectedCode: '',
		selectedType: '',
		selectedId: ''
	},
	methods: {
		isNullOfCode: function() {
			//alert('33');
			sessionStorage.removeItem('queryCode')
			this.selectedCode = '';
			this.selectedId = '';
			var _inputNum = this.queryCode.length;					
			this.popSelectExpress( );
		},
		popSelectExpress : function( ) {
			var self = this;
			if( self.queryCode.length >= 5 ) {				
				$.ajax({
					url: "http://kjgz.szmsd.com/query/queryAction!match.action?chars="+self.queryCode,
					type: 'get',
					dataType : 'jsonp',
					jsonp: 'jsoncallback',//与后台保持一致
					success : function( result ){
						if( result.length === 0 ) {
							$('.ui-popover').hide();
						}else{
							self.listData = result;
							$('.ui-popover').show();
						}						
						
					}					
				})
			
			}else {
				$('.ui-popover').hide();
			}
		},
		queryCodeFn: function( ) {
			var _type=encodeURI(encodeURI(this.selectedCode));
			var self = this;
			if( self.queryCode && self.selectedCode.length !== 0 ){
				self.requestData(_type);
			}else {
				self.popSelectExpress();
				sys.toast('请选择快递' );
			}
		},
		selectedList:function( id, data, type ) {
			if( data === '其他快递' ) {
				$('.ui-popover').hide();
				window.location.href='otherExpress.html?billcode='+id;
				return;	
			}
			
			this.queryCode = id;
			this.selectedCode = data;
			this.selectedType = 'normal';			
			//$('#queryData')[0].value=data;
			$('.ui-popover').hide();
			this.requestData(encodeURI(encodeURI(data)));
		},
		requestData: function(name){
			var self = this;
			//显示等待框
			sys.loading('load');			
			$.ajax({
				url: "http://kjgz.szmsd.com/query/queryAction!query.action?billcode="+self.queryCode+"&aType="
				+self.selectedType+"&type="+name,
				type: 'get',
				dataType : 'jsonp',
				jsonp: 'jsoncallback',//与后台保持一致
				success : function( result ) {
					//隐藏等待框
					sys.loading('loadClose');						
					var _dataArr = [];
					sys.log('data',result);
					if( result.success ){						
						if(  !result.data || !result.data.track ) {
							sys.toast( result.message );
							return;
						}
						
						if( typeof result.data.track.billcode === 'undefined' ) {
							result.data.track.billcode = self.queryCode;
						}
						window.location.href= 'queryDetail.html';
						
						localStorage.setItem( 'dec_queryDetailPage_listData', JSON.stringify( result ) );
						
						//setHistotyRecord( );					
						$('.ui-popover').hide();
						
					} else {
						
						var _paramsEr = {
							id : self.selectedCode,//快递名字
							code : self.queryCode,//运单号
							name : self.selectedCode//快递名字
						};
						
						if( result.ec ) {
							_paramsEr = result.ec;
							_paramsEr.name = self.selectedCode;
							_paramsEr.code = self.queryCode;
						}
						
						//window.location.href='resultFail.html?billcode='+self.queryCode;
						sessionStorage.setItem( 'dec_resultFailPage_company', JSON.stringify( _paramsEr ) );
					}
				},
				error : function( err ){				
					sys.toast('请求不到数据！');
				}
			})
		}
	}
})
